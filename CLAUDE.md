# CLAUDE.md: Terraria コレクション管理Webアプリ 開発ガイドライン

このファイルは、Terraria コレクション管理Webアプリの開発において、Claude Codeが遵守すべきコーディング規則、ベストプラクティス、およびプロジェクト固有の制約を定義します。

## 1. プロジェクトの目的と概要

プレイヤーがTerrariaの特定のアイテム（武器、防具、アクセサリー）とエンティティ（NPC、ボス）の収集状況を管理し、詳細情報を参照できるWebアプリケーションを開発します。Next.js (React) を使用し、データはローカルストレージに保存されます。

---

## 2. 一般的なコーディング規則とベストプラクティス

以下の一般的なコーディング規則とベストプラクティスを遵守してください。

### 2.1. コードの品質

* **可読性:** コードは常に明確で理解しやすいように記述してください。適切な変数名、関数名、コメントを使用してください。
* **保守性:** 将来の変更や拡張が容易なように、モジュール化された、疎結合なコードを記述してください。
* **効率性:** 可能な限り、パフォーマンスに配慮したコードを記述してください。特にリストレンダリングやデータ処理において。

### 2.2. コメント

* 複雑なロジックや、コードの意図を説明するために必要な箇所には、簡潔かつ明確なコメントを追加してください。
* JSDoc形式（TypeScript/JavaScriptの場合）など、ドキュメンテーションツールで解析可能なコメントも活用を検討してください。

### 2.3. エラーハンドリング

* ユーザーエクスペリエンスを損なわないように、予期されるエラーに対しては適切なエラーハンドリングを実装してください。
* 開発中に発見された未処理の例外はログに出力し、原因究明に役立つ情報を含めてください。

---

## 3. 技術スタック固有の規則

### 3.1. Next.js / React

* **コンポーネント指向:** 機能ごとに再利用可能なコンポーネントを作成し、コンポーネント間の責務を明確に分離してください。
* **Hooksの利用:** `useState`, `useEffect`, `useContext` などのReact Hooksを適切に活用してください。カスタムフックの作成も検討してください。
* **命名規則:**
    * コンポーネント名はPascalCase（例: `MyComponent`）。
    * カスタムフック名は `use` で始める（例: `useMyHook`）。
    * 変数名、関数名はcamelCase（例: `myVariable`, `myFunction`）。
* **ファイル構造:** `src` ディレクトリ内に`components`, `hooks`, `utils`, `types`, `data` などのフォルダを作成し、関連ファイルを整理してください。
* **データフロー:** Prop Drillingを避け、必要に応じてContext APIや、より複雑な状態管理が必要であれば軽量なライブラリの導入を検討してください。

### 3.2. TypeScript (Next.jsで利用する場合)

* **型定義:** 可能な限り厳密な型定義を使用し、型の恩恵を最大限に活用してください。
* **インターフェース/型エイリアス:** コンポーネントのProps、APIレスポンス、データ構造など、明確な型定義を記述してください。

### 3.3. スタイリング (Tailwind CSS または CSS Modules)

* **Tailwind CSSの場合:** 可能な限りユーティリティクラスを直接使用し、カスタムCSSの記述を最小限に抑えてください。
* **CSS Modulesの場合:** 各コンポーネントに対応するCSS Moduleファイルを作成し、クラス名の衝突を避けてください。

---

## 4. プロジェクト固有の制約と考慮事項

### 4.1. データ管理

* **ローカルストレージ:** ユーザーの所持/未所持データは、ブラウザの `localStorage` APIを使用して保存および取得してください。キー名はプロジェクトに固有で衝突しないように命名してください（例: `terraria-collection-status`）。
* **アイテムデータ:** アプリケーションで使用するアイテム、NPC、ボスの初期データは、`src/data/real-data/curated-items.json` で一元管理してください。このファイルは、各項目に必要なプロパティ（`id`, `name`, `category`, `iconPath`, `acquisition`, `stats`, `type` など）を含むように定義してください。
* **データとアイコンの整合性:** 新しいアイテムを追加する際は、必ず対応するアイコンファイルが `public/assets/icons/` に存在することを確認してください。`iconPath` フィールドと実際のファイル位置が一致している必要があります。
* **分類の正確性:** `type` フィールドは TypeScript の `ItemType` 型に準拠し、Terraria ゲーム内での実際の分類と一致させてください（例: Life Crystal は weapon ではなく consumable）。
* **単一真実のソース:** アイテムデータは複数のファイルで重複定義せず、`curated-items.json` のみで管理してください。
* **ファイル拡張子の整合性:** `iconPath` フィールドは実際のファイル拡張子と一致させてください。PNG ファイルは `.png`、SVG ファイルは `.svg` として参照してください。拡張子の不一致はアイコン表示の問題を引き起こします。

### 4.2. UI/UXの原則

* **シンプルさ:** UIはクリーンで直感的に操作できることを最優先してください。
* **フィードバック:** ユーザーのアクション（例: 所持/未所持の切り替え）に対して、視覚的なフィードバックを明確に提供してください。
* **色の利用:** 所持アイテムはカラー、未所持アイテムはグレーアウトという要件を厳密に守ってください。

### 4.3. 開発プロセス

* **段階的開発:** 大きな機能を一度に実装するのではなく、小さなコンポーネントや機能から段階的に開発を進めてください。
* **テスト（オプションだが推奨）:** 可能であれば、JestやReact Testing Libraryを使用した基本的なユニットテストの追加も検討してください。

### 4.4. 設定ファイルおよび依存関係の管理

* **慎重な変更:** `next.config.js`, `tsconfig.json`, `package.json`, `tailwind.config.js` などの**プロジェクト設定ファイルや依存関係（`package.json` の `dependencies`, `devDependencies`）の変更は、極力避けてください。**
* **Vercel設定の注意:** **`vercel.json`の作成・変更は特に慎重に行ってください。**Next.jsアプリケーションは通常、vercel.jsonなしで適切にデプロイされます。設定が必要な場合のみ最小限の設定を行ってください。
* **変更の必要性:** ただし、**新しい機能の実装、既存の問題の解決、またはパフォーマンスの最適化など、プロジェクトを前に進めるために明確な理由と必要性がある場合に限り、変更を提案または実行してください。**
* **変更前の確認:** 変更を行う際は、その変更が他の部分に与える影響を十分に考慮し、**予期せぬ副作用が発生しないよう最大限注意してください。**大規模な変更や不確実な変更を行う場合は、**まずその変更の意図と内容を明確に説明し、レビューを求めてください。**
* **依存関係の追加:** 新しいライブラリやツールを導入する必要がある場合は、その**選定理由と必要性を簡潔に説明し、`package.json` に追加してください。**不必要な依存関係の追加は避けてください。

### 4.5. デプロイメント前のチェック

* **ローカルビルドテスト:** pushする前に必ず `npm run build` でローカルビルドを実行し、エラーがないことを確認してください。
* **型整合性の確認:** TypeScriptの型定義に矛盾がないか確認してください。特に新しい型を追加した場合は、関連する全ての場所で整合性を保ってください。
* **コンポーネント名の統一:** importしているコンポーネント名と実際のコンポーネント名が一致していることを確認してください。

### 4.6. アイコン表示の問題と再発防止策

**重要:** 2025年7月16日に発生したアイコン表示の問題と解決策を記録します。

#### 発生した問題

1. **SVG ファイルの .gitignore 除外:** `.gitignore` で `/public/assets/icons/**/*.svg` が除外されていたため、SVG アイコンファイルがデプロイされない問題が発生しました。
2. **PNG/SVG 拡張子の不一致:** 542個のアイテムで `curated-items.json` 内の `iconPath` が実際のファイル拡張子と一致していませんでした（PNG ファイルを SVG として参照）。

#### 解決策

1. **`.gitignore` の修正:** SVG ファイルの除外を一時的に無効化し、全ての SVG ファイルを git に追加しました。
2. **データファイルの修正:** 542個のアイテムの `iconPath` を正しい拡張子（`.png`）に修正しました。

#### 再発防止策

1. **`.gitignore` の慎重な管理:** アイコンファイルの除外パターンを変更する際は、デプロイメントへの影響を十分に考慮してください。
2. **拡張子の整合性チェック:** 新しいアイテムを追加する際は、必ず `iconPath` と実際のファイル拡張子が一致していることを確認してください。
3. **定期的な検証:** 本番環境でアイコンが正しく表示されているか定期的に確認してください。
4. **テストスクリプトの検討:** アイコンファイルとデータファイルの整合性を自動的にチェックするスクリプトの作成を検討してください。

---

この`CLAUDE.md`ファイルは、AIがプロジェクトのコンテキストを理解し、より適切にコードを生成・修正するための指針となります。開発を進める中で、必要に応じてこのファイルを更新してください。